!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PlanetarySystem=e():t.PlanetarySystem=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>z});const s={createNode(t,e){const s=document.createElement("div");return s.className=t,e&&(s.style.width=s.style.height=e+"px"),s},createImage(t,e){const s=document.createElement("img");return s.classList.add(e),s.src=t,s},createLabel(t){const e=document.createElement("p");return e.textContent=t,e},getSceneHeight(t,{perspective:e,angle:s}){const i=s*Math.PI/180;return 2*(t/2+(t/2*Math.cos(i)-t/2)*e/(e+t/2*Math.sin(i)))}};class i{constructor(t){this.scale=t.scale||t.system.options.scales.sun,this.angle=t.angle||0,this.distance=t.distance||0,this.system=t.system,this.image=t.image,this.$node=s.createNode("ps-item ps-sun",this.system.itemSize),this.$image=s.createImage(this.image,"ps-image"),this.$node.appendChild(this.$image),this.system.$items.appendChild(this.$node),this.$label=s.createLabel("Click to reset"),this.$node.appendChild(this.$label),this.$node.addEventListener("click",(()=>{this.system.emit("sun:click")})),this.system.on("camera",(()=>{this.setTransform()})),this.setTransform()}get x(){return this.distance*Math.cos(this.angle*Math.PI/180)}get y(){return this.distance*Math.sin(this.angle*Math.PI/180)}setTransform(){this.$node.style.transform=`translate(${this.x-this.system.itemSize/2}px, ${this.y-this.system.itemSize/2}px) rotateX(-${this.system.camera.angle}deg) scale(${this.scale})`}}class n{constructor(t){this.size=t.system.normalOrbitSizes.moon,this.planet=t.planet,this.system=t.system,this.angle=this.planet.angle,this.opacity=0,this.$node=s.createNode(`ps-orbit ps-orbit-${this.planet.orbit.index} ps-planet-${this.planet.index} ps-moon-orbit`,this.size),this.system.$orbits.appendChild(this.$node),this.setOpacity()}setOpacity(){this.$node.style.opacity=this.opacity}setSize(){this.$node.style.width=this.$node.style.height=this.size+"px"}setTransform(){this.$node.style.transform=`translate(${this.planet.x-this.size/2}px, ${this.planet.y-this.size/2}px)`}}function a(t,e){t.spin=gsap.to(t,{repeat:-1,ease:Power0.easeNone,onUpdate:()=>t.setTransform(),...e}),t.spinStop=()=>{t.system.paused||t.spin.pause()},t.spinPlay=()=>{t.system.paused?t.setTransform():t.spin.resume()},t.system.on("pause",(()=>{t.spin.pause()})),t.system.on("resume",(()=>{t.spin.resume()})),t.system.on("timescale",(e=>{t.spin.timeScale(e)}))}function o(t,e){t.fade&&t.fade.kill(),t.fade=gsap.to(t,{duration:t.system.options.durations.fade,ease:Power1.easeInOut,onUpdate:()=>t.setOpacity(),...e})}function h(t,e){t.resize&&t.resize.kill(),t.resize=gsap.to(t,{duration:t.system.options.durations.translate,ease:Power1.easeInOut,onUpdate:()=>{t.setSize(),t.setTransform()},...e})}function r(t,e){let s;t.system.paused&&(s=()=>t.setTransform()),t.translate&&t.translate.kill(),t.translate=gsap.to(t,{duration:t.system.options.durations.translate,ease:Power1.easeInOut,onUpdate:s,...e})}class c{constructor(t){this.index=t.index,this.planet=t.planet,this.system=t.system,this.scale=t.scale||t.system.options.scales.moon,this.angle=360*t.index/t.planet.moons.length,this.distance=t.system.normalOrbitSizes.moon/2,this.zoom=1,this.image=t.image,this.label=t.label,this.note=t.note,this.opacity=0,this.$node=s.createNode(`ps-item ps-ring-${this.planet.orbit.index} ps-planet-${this.planet.index} ps-moon-${this.index} ps-moon`,t.system.itemSize),this.$image=s.createImage(this.image,"ps-image"),this.$label=s.createLabel(this.label),this.$node.appendChild(this.$image),this.$node.appendChild(this.$label),this.system.$items.appendChild(this.$node),a(this,{duration:2*Math.PI*this.distance*this.system.options.speed,angle:this.angle+360,paused:!0}),this.$node.addEventListener("mouseenter",(()=>{this.opacity>0&&this.system.emit("moon:enter",this)})),this.$node.addEventListener("mouseleave",(()=>{this.opacity>0&&this.system.emit("moon:leave",this)})),this.$node.addEventListener("click",(()=>{this.system.emit("moon:note",this)})),this.system.on("camera",(()=>{this.setTransform()})),this.setOpacity()}setOpacity(){this.$node.style.opacity=this.opacity}get x(){return this.planet.x+this.distance*Math.cos(this.angle*Math.PI/180)}get y(){return this.planet.y+this.distance*Math.sin(this.angle*Math.PI/180)}setTransform(){this.$node.style.transform=`translate3d(${this.x-this.system.itemSize/2}px, ${this.y-this.system.itemSize/2}px, 0) rotateX(-${this.system.camera.angle}deg) scale(${this.scale*this.zoom})`}}class l{constructor(t){this.index=t.index,this.orbit=t.orbit,this.system=t.system,this.moons=t.moons||[],this.scale=t.scale||t.system.options.scales.planet,this.angle=t.orbit.angle+360*this.index/t.orbit.planets.length,this.distance=t.orbit.size/2,this.zoom=1,this.image=t.image,this.label=t.label,this.note=t.note,this.active=!1,this.moonOrbit=new n({planet:this,system:this.system}),this.moons=this.moons.map(((t,e)=>new c({...t,index:e,planet:this,system:this.system}))),this.$node=s.createNode(`ps-item ps-planet ps-planet-${this.index} ps-orbit-${this.orbit.index}`,this.system.itemSize),this.$image=s.createImage(this.image,"ps-image"),this.$label=s.createLabel(this.label),this.$node.appendChild(this.$image),this.$node.appendChild(this.$label),this.system.$items.appendChild(this.$node),t.video&&(this.video=t.video,this.$video=s.createImage(t.system.options.videoIcon,"ps-video"),this.$node.appendChild(this.$video),this.$video.addEventListener("click",(t=>{this.system.emit("video",this),t.stopPropagation()}))),a(this,{duration:2*Math.PI*this.distance*this.system.options.speed,angle:this.angle+360}),this.$node.addEventListener("mouseenter",(()=>{this.system.emit("planet:enter",this)})),this.$node.addEventListener("mouseleave",(()=>{this.system.emit("planet:leave",this)})),this.$node.addEventListener("click",(()=>{this.active?this.system.emit("planet:note",this):this.system.emit("planet:click",this)})),this.system.on("camera",(()=>{this.setTransform()}))}get x(){return this.distance*Math.cos(this.angle*Math.PI/180)}get y(){return this.distance*Math.sin(this.angle*Math.PI/180)}setTransform(){this.$node.style.transform=`translate3d(${this.x-this.system.itemSize/2}px, ${this.y-this.system.itemSize/2}px, 0) rotateX(-${this.system.camera.angle}deg) scale(${this.scale*this.zoom})`}}class m{constructor(t){this.index=t.index,this.size=t.system.normalOrbitSizes[this.index],this.angle=t.angle||360*Math.random(),this.planets=t.planets||[],this.system=t.system,this.$node=s.createNode(`ps-orbit ps-orbit-${this.index} ps-planet-orbit`,this.size),this.system.$orbits.appendChild(this.$node),this.planets=this.planets.map(((t,e)=>new l({...t,index:e,orbit:this,system:this.system}))),this.setSize(),this.setTransform()}setSize(){this.$node.style.width=this.$node.style.height=this.size+"px"}setTransform(){this.$node.style.transform=`translate(-${this.size/2}px, -${this.size/2}px)`}}class d{constructor(t){this.x=0,this.y=0,this.minScale=0,this.maxScale=0,this.zoom=0,this.system=t,this.padding={},function(t){let e=!1;function s(t){return t.touches&&t.touches[0]||t.changedTouches&&t.changedTouches[0]||t}function i(i){if(i.touches&&i.touches.length>1)return a();const n=s(i);e={clientX:n.clientX,clientY:n.clientY,sceneX:t.x,sceneY:t.y}}function n(i){if(!e)return;const n=s(i);t.x=e.sceneX+n.clientX-e.clientX,t.y=e.sceneY+n.clientY-e.clientY,t.render(),i.preventDefault()}function a(){e=!1}t.system.$node.addEventListener("mousedown",i),document.addEventListener("mousemove",n),document.addEventListener("mouseup",a),document.addEventListener("mouseleave",a),t.system.$node.addEventListener("touchstart",i),document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("touchend",a),document.addEventListener("touchcancel",a)}(this),function(t){t.system.$node.addEventListener("wheel",(e=>{if(e.preventDefault(),e.deltaY>0&&0===t.zoom)return;if(e.deltaY<0&&1===t.zoom)return;const s=-e.deltaY/1e3,i={x:e.clientX,y:e.clientY};t.zoomTo(i,t.zoom+s)}));let e=!1;function s(t){const e=t.touches[0].clientX-t.touches[1].clientX,s=t.touches[0].clientY-t.touches[1].clientY;return Math.hypot(e,s)}function i(t){const e=Math.max(t.touches[0].clientX,t.touches[1].clientX),s=Math.min(t.touches[0].clientX,t.touches[1].clientX),i=Math.max(t.touches[0].clientY,t.touches[1].clientY);return{x:e-(e-s)/2,y:i-(i-Math.min(t.touches[0].clientY,t.touches[1].clientY))/2}}function n(){e=!1}t.system.$node.addEventListener("touchstart",(function(a){if(2!==a.touches.length)return n();e={},e.dist=s(a),e.zoom=t.zoom,e.origin=i(a)})),document.addEventListener("touchmove",(function(n){if(!e)return;const a=(s(n)-e.dist)/1e3;t.zoomTo(i(n),e.zoom+a),n.preventDefault()}),{passive:!1}),document.addEventListener("touchend",n),document.addEventListener("touchcancel",n)}(this),function(t){function e(){const e=getComputedStyle(t.system.$node);t.padding.top=parseFloat(e.getPropertyValue("padding-top")),t.padding.right=parseFloat(e.getPropertyValue("padding-right")),t.padding.bottom=parseFloat(e.getPropertyValue("padding-bottom")),t.padding.left=parseFloat(e.getPropertyValue("padding-left"));const s=t.system.$node.offsetWidth-t.padding.right-t.padding.left,i=t.system.$node.offsetHeight-t.padding.bottom-t.padding.top,n=Math.min(s,i),a=t.system.$scene.offsetWidth,o=t.system.$scene.offsetHeight;t.zoom=.6,t.minScale=Math.min(n/a,n/o),t.maxScale=Math.min(n)/2/t.system.options.sizes.item/t.system.options.scales.sun,t.x=(s-a*t.scale)/2,t.y=(i-o*t.scale)/2,t.render(),t.system.emit("zoom",t.zoom)}e(),window.addEventListener("resize",e),t.system.on("camera",e)}(this)}get scale(){return this.minScale*Math.pow(this.maxScale/this.minScale,this.zoom)}zoomTo(t,e){const{left:s,top:i}=this.system.$node.getBoundingClientRect(),n=t.x-s-this.padding.left,a=t.y-i-this.padding.top,o=(n-this.x)/this.scale,h=(a-this.y)/this.scale;e=Math.max(e,0),e=Math.min(e,1),this.zoom=e,this.x=n-o*this.scale,this.y=a-h*this.scale,this.render(),this.system.emit("zoom",this.zoom)}render(){this.system.$scene.style.transform=`translate(${this.x}px, ${this.y}px) scale(${this.scale})`}}function p(t,e){t.active||t.translate&&t.translate.isActive()||(t.hovered=!0,t.orbit.planets.forEach((t=>{t.spinStop()})),t.moonOrbit.setTransform(),o(t.moonOrbit,{opacity:1}),t.moons.forEach((t=>{t.spinPlay(),o(t,{opacity:1})})))}function u(t){t.active||t.translate&&t.translate.isActive()||(t.hovered=!1,t.orbit.planets.forEach((t=>{t.spinPlay()})),o(t.moonOrbit,{opacity:0,onUpdate(){t.moonOrbit.setOpacity(),t.moonOrbit.setTransform()}}),t.moons.forEach((t=>{o(t,{opacity:0,onComplete(){t.spinStop()}})})))}function y(t,e){t.active=!1;const s=e.active?e.activeOrbitSizes[t.orbit.index+1]:e.normalOrbitSizes[t.orbit.index],i=e.active?e.activeOrbitSizes.moon:e.normalOrbitSizes.moon;r(t,{distance:s/2,zoom:1}),h(t.moonOrbit,{size:i}),o(t.moonOrbit,{opacity:0}),t.moons.forEach((t=>{r(t,{distance:i/2,zoom:1})})),t.moons.forEach((t=>{o(t,{opacity:0,onComplete:()=>{t.spinStop()}})}))}function f(t,e){r(t,{distance:(e.active?e.activeOrbitSizes[t.orbit.index+1]:e.normalOrbitSizes[t.orbit.index])/2})}function g(t,e){const s=!e.active;s&&r(e.sun,{distance:Math.sqrt(2)*(e.options.sizes.canvas-e.options.sizes.item*e.sun.scale)/2,onUpdate(){e.sun.setTransform()}}),e.active=t,e.orbits.forEach((i=>{h(i,{size:e.activeOrbitSizes[i.index+1]}),i.planets.forEach((i=>{i===t?function(t,e){t.hovered||e.emit("planet:enter",t),t.active=!0,t.hovered=!1,t.orbit.planets.forEach((t=>{t.spinPlay()})),r(t,{distance:0,zoom:e.sun.scale/t.scale}),h(t.moonOrbit,{size:e.activeOrbitSizes[0]}),t.moons.forEach((t=>{r(t,{distance:e.activeOrbitSizes[0]/2,zoom:e.options.scales.planet/t.scale})}))}(i,e):i.active?y(i,e):s&&f(i,e)}))}))}function $(t){t.planet.translate&&t.planet.translate.isActive()||(t.planet.active?t.planet.moons.forEach((t=>{t.spinStop()})):(t.planet.orbit.planets.forEach((t=>{t.spinStop()})),t.planet.moonOrbit.setTransform(),o(t.planet.moonOrbit,{opacity:1}),t.planet.moons.forEach((t=>{t.spinStop(),o(t,{opacity:1})}))))}function b(t){t.planet.translate&&t.planet.translate.isActive()||(t.planet.active?t.planet.moons.forEach((t=>{t.spinPlay()})):(t.planet.orbit.planets.forEach((t=>{t.spinPlay()})),o(t.planet.moonOrbit,{opacity:0,onUpdate(){t.planet.moonOrbit.setOpacity(),t.planet.moonOrbit.setTransform()}}),t.planet.moons.forEach((t=>{o(t,{opacity:0,onStart(){t.spinPlay()},onComplete(){t.spinStop()}})}))))}function v(t,e){r(e.sun,{distance:0,onUpdate(){e.sun.setTransform()}}),e.active=!1,e.orbits.forEach((t=>{h(t,{size:e.normalOrbitSizes[t.index]}),t.planets.forEach((t=>{t.active?y(t,e):f(t,e)}))}))}class z{constructor(t,e){var n;this.options=e,this.$node=t,this.$node.classList.add("ps-system"),this.$scene=s.createNode("ps-scene"),this.$orbits=s.createNode("ps-canvas ps-canvas--orbits"),this.$items=s.createNode("ps-canvas ps-canvas--items"),this.$scene.appendChild(this.$orbits),this.$scene.appendChild(this.$items),this.$node.appendChild(this.$scene),this.listeners=[],this.normalOrbitSizes=this.getOrbitSizes(this.maxOrbit),this.activeOrbitSizes=this.getOrbitSizes(this.maxOrbit+1),this.active=null,this.paused=!1,this.timeScale=1,this.setCamera(e.camera),this.scene=new d(this),this.sun=new i({...e.sun,system:this}),this.orbits=e.orbits.map(((t,e)=>new m({...t,index:e,system:this}))),(n=this).on("planet:enter",p),n.on("planet:leave",u),n.on("moon:enter",$),n.on("moon:leave",b),n.on("planet:click",g),n.on("sun:click",v)}getOrbitSizes(t){const{moon:e,sun:s}=this.options.scales,{canvas:i,item:n}=this.options.sizes,a=(i-n*s)/(2*t+1);let o=Array.from({length:t},((t,e)=>n*s+(e+1)*a*2));return o.moon=a-n*e,o}get maxOrbit(){return this.options.orbits.length}get itemSize(){return this.options.sizes.item}setCamera(t){const e=t.angle?`perspective(${t.perspective}px) translateY(50%) rotateX(${t.angle}deg) translateY(-50%)`:"";this.$orbits.style.transform=this.$items.style.transform=e,this.$scene.style.width=this.options.sizes.canvas+"px",this.$scene.style.height=s.getSceneHeight(this.options.sizes.canvas,t)+"px",this.camera=t,this.emit("camera",t)}on(t,e){this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)}off(t,e){if(!this.listeners[t])return;const s=this.listeners[t].indexOf(e);s>-1&&this.listeners[t].splice(s,1)}emit(t,e){this.listeners[t]&&this.listeners[t].forEach((t=>t(e,this)))}resume(){this.paused=!1,this.emit("resume")}pause(){this.paused=!0,this.emit("pause")}setTimeScale(t){this.timeScale=t,this.emit("timescale",this.timeScale)}}return e.default})()}));
//# sourceMappingURL=planetary-system.js.map